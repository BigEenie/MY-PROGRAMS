{% extends "base.html" %}

{% block title %}Groups - University of Ibadan Social Platform{% endblock %}

{% block content %}
<div class="container">
    <div class="groups-header">
        <div class="row align-items-center mb-4">
            <div class="col-md-6">
                <h1 class="groups-title">
                    <i class="fas fa-users me-2"></i>Groups
                </h1>
                <p class="text-muted">Join or create study groups and department discussions</p>
            </div>
            <div class="col-md-6 text-end">
                <a href="{{ url_for('messages') }}" class="btn btn-outline-secondary me-2">
                    <i class="fas fa-envelope me-1"></i>Messages
                </a>
                <a href="{{ url_for('create_group_route') }}" class="btn btn-ui-blue">
                    <i class="fas fa-plus me-1"></i>Create Group
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            {% if groups %}
                <div class="groups-grid">
                    {% for group in groups %}
                        <div class="group-card">
                            <div class="group-header">
                                <h5 class="group-name">{{ group.name }}</h5>
                                {% if group.department %}
                                    <span class="badge bg-ui-blue">{{ group.department }}</span>
                                {% endif %}
                            </div>
                            
                            <div class="group-info">
                                <div class="group-meta">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-user-crown text-ui-blue me-2"></i>
                                        <span class="text-muted">Created by {{ group.creator.full_name }}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-users text-ui-blue me-2"></i>
                                        <span class="text-muted">{{ group.member_count }} members</span>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-calendar text-ui-blue me-2"></i>
                                        <span class="text-muted">Created {{ group.created_at[:10] }}</span>
                                    </div>
                                </div>
                                
                                <div class="group-members mt-3">
                                    <small class="text-muted d-block mb-2">Members:</small>
                                    <div class="members-list">
                                        {% for member in group.members[:5] %}
                                            <div class="member-item">
                                                {% if member.profile_photo %}
                                                    <img src="{{ url_for('uploaded_file', filename=member.profile_photo) }}" 
                                                         alt="{{ member.full_name }}" class="member-avatar">
                                                {% else %}
                                                    <div class="member-avatar-placeholder">
                                                        <i class="fas fa-user"></i>
                                                    </div>
                                                {% endif %}
                                                <span class="member-name">{{ member.full_name }}</span>
                                            </div>
                                        {% endfor %}
                                        {% if group.member_count > 5 %}
                                            <div class="member-item">
                                                <div class="member-avatar-placeholder">
                                                    <span>+{{ group.member_count - 5 }}</span>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="group-actions">
                                <a href="{{ url_for('group_chat', group_id=group.id) }}" 
                                   class="btn btn-ui-blue w-100">
                                    <i class="fas fa-comments me-1"></i>Enter Group Chat
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-users fa-4x text-muted mb-3"></i>
                    <h5 class="text-muted">No groups yet</h5>
                    <p class="text-muted">Create or join study groups and department discussions!</p>
                    <a href="{{ url_for('create_group_route') }}" class="btn btn-ui-blue">
                        <i class="fas fa-plus me-1"></i>Create Your First Group
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}